schema: '2.0'
stages:
  clean_data:
    cmd: python src\data\clean_data.py
    deps:
    - path: data\training
      md5: 7a96cfa2ff8c169761a068447405c17e.dir
      size: 5926077
      nfiles: 3
    - path: src\data\clean_data.py
      md5: 446fefd52294d288399ab790a42b6388
      size: 2633
    outs:
    - path: data\prepared
      md5: 15682c488e4b458bdc8b68fb97c82852.dir
      size: 591595
      nfiles: 1
  generate_training_features:
    cmd: python -W ignore src\data\generate_training_features.py
    deps:
    - path: data\prepared
      md5: 15682c488e4b458bdc8b68fb97c82852.dir
      size: 591595
      nfiles: 1
    - path: src\data\generate_training_features.py
      md5: 0925fdb9bfeba3fb2feb1d4ea61436d0
      size: 6515
    - path: src\models\feature_eng
      md5: 0c2e990a040f8c4e6b968a51d9657d52.dir
      size: 35637
      nfiles: 7
    params:
      params.yaml:
        featurize:
          tfidf:
            random_seed: 2023
            dim_reduction: 1
            var_explained: 0.2
            output:
              folder: feature\tfidf
              filename: tfidf.parquet
          count_vector:
            random_seed: 2023
            dim_reduction: 1
            var_explained: 0.9
            output:
              folder: feature\cntvector
              filename: count_vectorizer.parquet
        pipeline_type:
          KFoldTE: true
          frequency_encoding: false
          KFold_frequency_encoding: false
          tfidf_vectorizer_encoding: false
          count_vectorizer_encoding: true
        train_test_split:
          test_size: 0.01
          random_seed: 45
          train_data: feature\train\train_data.parquet
          test_data: feature\test\test_data.parquet
    outs:
    - path: data\feature\
      md5: 781a8ed6213f1948c39b7a03b499062e.dir
      size: 8984869
      nfiles: 2
  train_model:
    cmd: python src\data\train_model.py
    deps:
    - path: data\feature\
      md5: 781a8ed6213f1948c39b7a03b499062e.dir
      size: 8984869
      nfiles: 2
    - path: src\data\train_model.py
      md5: 08fbae7b257e9c8b0b95a6fd9ded7326
      size: 4822
    params:
      params.yaml:
        model:
          model_type: extra_decision_tree
          logistic_reg:
            hyper_params:
              max_iter: 50
              penalty: l2
              C: 1.0
              class_weight: balanced
          decision_tree:
            hyper_params:
              max_depth: 14
              splitter: best
              min_samples_leaf: 0.001
              max_features: 0.3
              class_weight: balanced
          extra_decision_tree:
            hyper_params:
              n_estimators: 1000
              max_depth: 5
              bootstrap: true
              max_samples: 0.01
              max_features: 0.3
              min_samples_leaf: 0.001
              class_weight: balanced_subsample
          trained_model: model\model.pkl
          eval:
            evals: eval
            eval_metrics: metrics
            eval_plots: plots
    outs:
    - path: data\model
      md5: 107886f282fe86ffe255a2c080e1f7e6.dir
      size: 1285279
      nfiles: 1
  evaluate_model:
    cmd: python src\data\eval.py
    deps:
    - path: data\model
      md5: 107886f282fe86ffe255a2c080e1f7e6.dir
      size: 1285279
      nfiles: 1
    - path: src\data\eval.py
      md5: 70169681883d3b066b20b7a067319f0e
      size: 12188
    outs:
    - path: data\eval\metrics\metrics.json
      md5: a2ae8feb6f3ea74d15b7ccf225fa6e02
      size: 80
    - path: data\eval\plots\confusion_matrix.png
      md5: 17d2a2c6ed9b6f6c76a9946d594e8dfb
      size: 15898
    - path: data\eval\plots\pr_rc_curve.png
      md5: cf67f194b19127c4357f081d1f59273f
      size: 21162
    - path: data\eval\plots\roc_curve.png
      md5: 9e9b4ed47982ee47f82e59eb6714c9cc
      size: 26221
