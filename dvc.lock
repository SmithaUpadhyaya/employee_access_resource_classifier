schema: '2.0'
stages:
  clean_data:
    cmd: python src\data\clean_data.py
    deps:
    - path: data\training
      md5: 7a96cfa2ff8c169761a068447405c17e.dir
      size: 5926077
      nfiles: 3
    - path: src\data\clean_data.py
      md5: 446fefd52294d288399ab790a42b6388
      size: 2633
    outs:
    - path: data\prepared
      md5: 15682c488e4b458bdc8b68fb97c82852.dir
      size: 591595
      nfiles: 1
  generate_training_features:
    cmd: python -W ignore src\data\generate_training_features.py
    deps:
    - path: data\prepared
      md5: 15682c488e4b458bdc8b68fb97c82852.dir
      size: 591595
      nfiles: 1
    - path: src\data\generate_training_features.py
      md5: 11733fe9de9928e1ccdc4b089031a1c7
      size: 6823
    - path: src\models\feature_eng
      md5: 6c0485e6982bb4f4e8926ca630433e4a.dir
      size: 47289
      nfiles: 11
    params:
      params.yaml:
        featurize:
          combine_feat:
            targetcol: ACTION
            ignore_columns:
            - ROLE_TITLE
            - MGR_ID
            - RESOURCE
          ktarget_enc:
            n_fold: 15
            random_seed: 2023
            targetcol: ACTION
            columns: []
          random_catagory_encode:
            random_seed: 2023
            targetcol: ACTION
            random_cnt: 5
            columns:
            - RESOURCE
            - ROLE_ROLLUP_1
            - ROLE_ROLLUP_2
            - ROLE_DEPTNAME
            - ROLE_FAMILY_DESC
            - ROLE_FAMILY
            - ROLE_CODE
          fequency_encode:
            min_group_size: 2
            n_fold: 5
            random_seed: 2023
            targetcol: ACTION
            log_transform: true
            columns:
            - ROLE_DEPTNAME
            - ROLE_ROLLUP_1_ROLE_DEPTNAME
            - ROLE_ROLLUP_2_ROLE_DEPTNAME
            - ROLE_ROLLUP_2_ROLE_CODE
            - ROLE_DEPTNAME_ROLE_FAMILY_DESC
            - ROLE_DEPTNAME_ROLE_FAMILY
            - ROLE_DEPTNAME_ROLE_CODE
          tfidf:
            random_seed: 2023
            pair_columns:
            - RESOURCE
            permute_columns:
            - ROLE_ROLLUP_1
            - ROLE_ROLLUP_2
            - ROLE_DEPTNAME
            - ROLE_FAMILY_DESC
            - ROLE_FAMILY
            - ROLE_CODE
            - ROLE_ROLLUP_1_ROLE_DEPTNAME
            - ROLE_ROLLUP_2_ROLE_DEPTNAME
            - ROLE_ROLLUP_2_ROLE_CODE
            - ROLE_DEPTNAME_ROLE_FAMILY_DESC
            - ROLE_DEPTNAME_ROLE_FAMILY
            - ROLE_DEPTNAME_ROLE_CODE
            targetcol: ACTION
            combine_columns_required: false
            dim_reduction:
              ROLE_ROLLUP_1: 27
              ROLE_ROLLUP_2: 21
              ROLE_DEPTNAME: 129
              ROLE_FAMILY_DESC: 328
              ROLE_FAMILY: 15
              ROLE_CODE: 60
              ROLE_ROLLUP_1_ROLE_DEPTNAME: 160
              ROLE_ROLLUP_2_ROLE_DEPTNAME: 154
              ROLE_ROLLUP_2_ROLE_CODE: 90
              ROLE_DEPTNAME_ROLE_FAMILY_DESC: 317
              ROLE_DEPTNAME_ROLE_FAMILY: 130
              ROLE_DEPTNAME_ROLE_CODE: 186
            output:
              folder: feature\tfidf
              filename: tfidf.parquet
          count_vector:
            random_seed: 2023
            dim_reduction: 1
            var_explained: 0.9
            targetcol: ACTION
            combine_columns_required: false
            columns: []
            output:
              folder: feature\cntvector
              filename: count_vectorizer.parquet
        model.decision_tree.pipeline_type:
          KFoldTE: false
          frequency_encoding: true
          KFold_frequency_encoding: false
          tfidf_vectorizer_encoding: true
          count_vectorizer_encoding: false
          random_catagory_encode: false
        model.extra_decision_tree.pipeline_type:
          KFoldTE: true
          frequency_encoding: false
          KFold_frequency_encoding: false
          tfidf_vectorizer_encoding: true
          count_vectorizer_encoding: false
          random_catagory_encode: false
        model.logistic_reg.pipeline_type:
          KFoldTE: true
          frequency_encoding: false
          KFold_frequency_encoding: false
          tfidf_vectorizer_encoding: false
          count_vectorizer_encoding: true
          random_catagory_encode: false
        model.model_type: xgboost
        model.random_forest.pipeline_type:
          KFoldTE: false
          frequency_encoding: true
          KFold_frequency_encoding: false
          tfidf_vectorizer_encoding: true
          count_vectorizer_encoding: false
          random_catagory_encode: false
        model.xgboost.pipeline_type:
          KFoldTE: false
          frequency_encoding: true
          KFold_frequency_encoding: false
          tfidf_vectorizer_encoding: true
          count_vectorizer_encoding: false
          random_catagory_encode: false
        train_test_split:
          test_size: 0.01
          random_seed: 7899
          cv: 5
          train_data: feature\train_data.parquet
    outs:
    - path: data\feature\
      md5: a63a99eaa363b6dcca2462fb33aa40e4.dir
      size: 86939915
      nfiles: 1
  train_model:
    cmd: python -W ignore src\data\train_model.py
    deps:
    - path: data\feature\
      md5: a63a99eaa363b6dcca2462fb33aa40e4.dir
      size: 86939915
      nfiles: 1
    - path: src\data\train_model.py
      md5: 006be9b048f7e975c856714cb3489dcc
      size: 8401
    params:
      params.yaml:
        model.decision_tree.hyper_params:
          random_state: 2034
          max_depth: 40
          splitter: best
          min_samples_leaf: 0.005
          max_features: sqrt
        model.extra_decision_tree.hyper_params:
          random_state: 56
          n_estimators: 55
          max_depth: 4
          bootstrap: true
          max_samples: 0.75
          max_features: 0.7
          min_samples_leaf: 0.5
          class_weight: balanced
        model.logistic_reg.hyper_params:
          random_state: 2023
          max_iter: 40
          penalty: l2
          solver: liblinear
          C: 11
        model.model_type: xgboost
        model.random_forest.hyper_params:
          random_state: 42
          n_estimators: 220
          max_depth: 5
          bootstrap: true
          max_samples: 0.5
          max_features: 0.5
          min_samples_leaf: 0.005
          class_weight: balanced
        model.xgboost.hyper_params:
          n_estimators: 50
          reg_lambda: 1.1800000000000002
          max_depth: 5
          learning_rate: 0.01
          random_state: 2045
          colsample_bytree: 0.685
    outs:
    - path: data\model\metrics\metrics.json
      md5: c368ba17fc62155867df67f0828dcdb2
      size: 75
  evaluate_model:
    cmd: python src\data\eval.py
    deps:
    - path: data\model
      md5: e16941fb70e9c3401de9df9dc9870e9f.dir
      size: 32977
      nfiles: 1
    - path: src\data\eval.py
      md5: 64779cb95c7bf90ff0f45abd4722d6a2
      size: 12080
    outs:
    - path: data\eval\metrics\metrics.json
      md5: bd822b5620ed49d00a7ee86bb046b3ba
      size: 80
    - path: data\eval\plots\confusion_matrix.png
      md5: 8ccc83fbfab075ed404888d66c50f761
      size: 16259
    - path: data\eval\plots\pr_rc_curve.png
      md5: 0ee74bacf57f7daa655da842106347d9
      size: 23723
    - path: data\eval\plots\roc_curve.png
      md5: e5d3dd354e83c2731d920315c6a3023d
      size: 25948
