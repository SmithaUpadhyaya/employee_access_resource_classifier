schema: '2.0'
stages:
  clean_data:
    cmd: python src\data\clean_data.py
    deps:
    - path: data\training
      md5: 7a96cfa2ff8c169761a068447405c17e.dir
      size: 5926077
      nfiles: 3
    - path: src\data\clean_data.py
      md5: 446fefd52294d288399ab790a42b6388
      size: 2633
    outs:
    - path: data\prepared
      md5: 15682c488e4b458bdc8b68fb97c82852.dir
      size: 591595
      nfiles: 1
  generate_training_features:
    cmd: python -W ignore src\data\generate_training_features.py
    deps:
    - path: data\prepared
      md5: 15682c488e4b458bdc8b68fb97c82852.dir
      size: 591595
      nfiles: 1
    - path: src\data\generate_training_features.py
      md5: b6c57cadce0ac106406bf20fc5f871d7
      size: 6698
    - path: src\models\feature_eng
      md5: 50b771b3bcb26903ef3c8f17b06900c1.dir
      size: 37634
      nfiles: 7
    params:
      params.yaml:
        featurize:
          tfidf:
            random_seed: 2023
            dim_reduction: 1
            var_explained: 0.2
            output:
              folder: feature\tfidf
              filename: tfidf.parquet
          count_vector:
            random_seed: 2023
            dim_reduction: 1
            var_explained: 0.9
            output:
              folder: feature\cntvector
              filename: count_vectorizer.parquet
        model:
          model_type: logistic_reg
          logistic_reg:
            pipeline_type:
              KFoldTE: true
              frequency_encoding: false
              KFold_frequency_encoding: false
              tfidf_vectorizer_encoding: true
              count_vectorizer_encoding: false
            hyper_params:
              max_iter: 900
              penalty: l2
              C: 10000
              class_weight: balanced
            trained_model: model\logistic_reg\model.pkl
            eval_metrics: model\logistic_reg\metrics
            eval_plots: model\logistic_reg\plots
          decision_tree:
            pipeline_type:
              KFoldTE: false
              frequency_encoding: true
              KFold_frequency_encoding: true
              tfidf_vectorizer_encoding: false
              count_vectorizer_encoding: true
            hyper_params:
              max_depth: 14
              splitter: best
              min_samples_leaf: 0.001
              max_features: 0.3
              class_weight: balanced
            trained_model: model\decision_tree\model.pkl
            eval_metrics: model\decision_tree\metrics
            eval_plots: model\decision_tree\plots
          extra_decision_tree:
            pipeline_type:
              KFoldTE: false
              frequency_encoding: true
              KFold_frequency_encoding: true
              tfidf_vectorizer_encoding: false
              count_vectorizer_encoding: true
            hyper_params:
              n_estimators: 30
              max_depth: 5
              bootstrap: true
              max_samples: 0.95
              max_features: 0.5
              min_samples_leaf: 0.001
              class_weight: balanced_subsample
            trained_model: model\extra_decision_tree\model.pkl
            eval_metrics: model\extra_decision_tree\metrics
            eval_plots: model\extra_decision_tree\plots
          random_forest:
            pipeline_type:
              KFoldTE: false
              frequency_encoding: true
              KFold_frequency_encoding: true
              tfidf_vectorizer_encoding: false
              count_vectorizer_encoding: true
            hyper_params:
              n_estimators: 100
              max_depth: 6
              bootstrap: true
              max_samples: 0.95
              max_features: 0.6
              min_samples_leaf: 0.002
              class_weight: balanced_subsample
            trained_model: model\random_forest\model.pkl
            eval_metrics: model\random_forest\metrics
            eval_plots: model\random_forest\plots
        train_test_split:
          test_size: 0.01
          random_seed: 45
          cv: 5
          train_data: feature\train_data.parquet
    outs:
    - path: data\feature\
      md5: 8f19e2db1fc494b7282f5be1dd1b8a4c.dir
      size: 1306969
      nfiles: 1
  train_model:
    cmd: python -W ignore src\data\train_model.py
    deps:
    - path: data\feature\
      md5: 8f19e2db1fc494b7282f5be1dd1b8a4c.dir
      size: 1306969
      nfiles: 1
    - path: src\data\train_model.py
      md5: 4e966ea802f899c1b20f10fe16baaa15
      size: 7599
    params:
      params.yaml:
        model:
          model_type: logistic_reg
          logistic_reg:
            pipeline_type:
              KFoldTE: true
              frequency_encoding: false
              KFold_frequency_encoding: false
              tfidf_vectorizer_encoding: true
              count_vectorizer_encoding: false
            hyper_params:
              max_iter: 900
              penalty: l2
              C: 10000
              class_weight: balanced
            trained_model: model\logistic_reg\model.pkl
            eval_metrics: model\logistic_reg\metrics
            eval_plots: model\logistic_reg\plots
          decision_tree:
            pipeline_type:
              KFoldTE: false
              frequency_encoding: true
              KFold_frequency_encoding: true
              tfidf_vectorizer_encoding: false
              count_vectorizer_encoding: true
            hyper_params:
              max_depth: 14
              splitter: best
              min_samples_leaf: 0.001
              max_features: 0.3
              class_weight: balanced
            trained_model: model\decision_tree\model.pkl
            eval_metrics: model\decision_tree\metrics
            eval_plots: model\decision_tree\plots
          extra_decision_tree:
            pipeline_type:
              KFoldTE: false
              frequency_encoding: true
              KFold_frequency_encoding: true
              tfidf_vectorizer_encoding: false
              count_vectorizer_encoding: true
            hyper_params:
              n_estimators: 30
              max_depth: 5
              bootstrap: true
              max_samples: 0.95
              max_features: 0.5
              min_samples_leaf: 0.001
              class_weight: balanced_subsample
            trained_model: model\extra_decision_tree\model.pkl
            eval_metrics: model\extra_decision_tree\metrics
            eval_plots: model\extra_decision_tree\plots
          random_forest:
            pipeline_type:
              KFoldTE: false
              frequency_encoding: true
              KFold_frequency_encoding: true
              tfidf_vectorizer_encoding: false
              count_vectorizer_encoding: true
            hyper_params:
              n_estimators: 100
              max_depth: 6
              bootstrap: true
              max_samples: 0.95
              max_features: 0.6
              min_samples_leaf: 0.002
              class_weight: balanced_subsample
            trained_model: model\random_forest\model.pkl
            eval_metrics: model\random_forest\metrics
            eval_plots: model\random_forest\plots
    outs:
    - path: data\model\metrics\metrics.json
      md5: 391bc5921768472086c71af131b0036e
      size: 76
  evaluate_model:
    cmd: python src\data\eval.py
    deps:
    - path: data\model
      md5: e16941fb70e9c3401de9df9dc9870e9f.dir
      size: 32977
      nfiles: 1
    - path: src\data\eval.py
      md5: 64779cb95c7bf90ff0f45abd4722d6a2
      size: 12080
    outs:
    - path: data\eval\metrics\metrics.json
      md5: bd822b5620ed49d00a7ee86bb046b3ba
      size: 80
    - path: data\eval\plots\confusion_matrix.png
      md5: 8ccc83fbfab075ed404888d66c50f761
      size: 16259
    - path: data\eval\plots\pr_rc_curve.png
      md5: 0ee74bacf57f7daa655da842106347d9
      size: 23723
    - path: data\eval\plots\roc_curve.png
      md5: e5d3dd354e83c2731d920315c6a3023d
      size: 25948
